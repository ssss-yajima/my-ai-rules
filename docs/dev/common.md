# 共通開発ガイドライン

## 設計原則

### データ駆動・スキーマ駆動開発
- テーブル設計やデータ構造を最優先で設計する
- データモデルの確定後に、それに基づいてアプリケーションロジックを実装する
- データの整合性と拡張性を重視した設計を行う

### インフラストラクチャ設計
- Webアプリケーションのホスティング方法は開発初期に決定する
- インフラ選定時は `docs/dev/infra.md` を作成し、以下を記載する：
  - 選定理由と比較検討内容
  - システムアーキテクチャ図
  - デプロイメントフローとCI/CD構成

## コード品質管理

### 品質維持の実践
- 定期的なコードレビューとリファクタリングを実施
- 重複コードの削除と共通化を推進
- ハードコーディングを避け、設定ファイルや定数を活用
- 不要になったソースコードやファイルは速やかに削除

### セキュリティチェック
secretlint による機密情報の漏洩防止

### Pre-commit Hook 設定
**初期設定**
```bash
mise run setup
```

**Lint/Format 設定**
- 各言語/フレームワークのセットアップを事前に済ませる
- プロジェクトルートの `package.json` に `lint-staged` 設定を追加
   - 各サブパッケージのlint, formatコマンドを設定する

**Pre-commit Hook 設定**
各サブパッケージに `.lintstagedrc` を追加してlit, formatコマンドを設定する。

例：Pythonの場合
```
{
  "**/*.py": [
    "uv run ruff check --fix",
    "uv run ruff format"
  ]
}
```

例：TypeScriptの場合
```
{
  "**/*.{js,jsx,ts,tsx,json,css}": [
    "npx @biomejs/biome check --write"
  ]
}
```


secretlint, yamllintなど全体に対するlinterはPJルートに設定する。

```
{
  "**/*": "secretlint",
  "uvx yamllint -d "{ignore-from-file: .gitignore}" . 
}
```


`npx lint-staged --verbose` を実行して動作確認を行う。




## 開発ワークフロー

### ツール・コマンド・環境変数の管理
- mise を使用してツール・コマンド・環境変数を管理する
- 主要なコマンドは `mise.toml` に定義
- コマンドの追加・更新・削除時は必ず `mise.toml` を更新
- `mise tasks` で利用可能なコマンドを確認
- `mise run <task>` でコマンドを実行
- その他のリファレンスは @docs/dev/references/mise-tasks.md を参照

### テスト方針
- **重要なビジネスロジック**にはテストを作成
- **実装アプローチ**：
  - モックの使用は最小限に抑える
  - 可能な限り実際のリソースを使用した統合テストを優先
- **カバレッジ目標**：
  - 100%のカバレッジは不要
  - コアな機能の動作保証とリファクタリング時の安全性確保を重視
